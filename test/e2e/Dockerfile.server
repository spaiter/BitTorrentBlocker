# Dockerfile for E2E Server
FROM golang:1.20-alpine

# Install dependencies
RUN apk add --no-cache \
    linux-headers \
    libpcap-dev \
    iptables \
    ipset \
    make \
    gcc \
    musl-dev \
    bash \
    python3

# Set working directory
WORKDIR /app

# Copy go mod files
COPY go.mod go.sum ./
RUN go mod download

# Copy source
COPY . .

# Build btblocker
RUN make build

# Expose test port
EXPOSE 6881 8000

# Load kernel modules at runtime
CMD ["/bin/sh"]
